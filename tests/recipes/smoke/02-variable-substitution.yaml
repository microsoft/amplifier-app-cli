name: "test-variable-substitution"
description: "Smoke test: Variable substitution in context and prompts"
version: "1.0.0"
author: "Amplifier Recipes Team"
created: "2025-12-10T00:00:00Z"
tags: ["test", "smoke", "variables", "context"]

# Test: Verify that context variables are substituted correctly in prompts
# Expected outcome: Variables defined in context are accessible and substituted
#
# This test verifies:
# 1. Variables can be defined in the context section
# 2. Variable substitution works with {{variable_name}} syntax
# 3. Different data types (string, number, boolean) are handled correctly
# 4. Variables are accessible to all steps in the recipe

context:
  test_string: "hello-world"
  test_number: 42
  test_boolean: "true"

steps:
  - id: "use-variables"
    agent: "foundation:explorer"
    prompt: |
      You are testing variable substitution. Please confirm you received these values:
      
      String value: {{test_string}}
      Number value: {{test_number}}
      Boolean value: {{test_boolean}}
      
      Echo back each value exactly as you received it, in this format:
      - String: [value]
      - Number: [value]
      - Boolean: [value]
    output: "echo_result"
    timeout: 30

  - id: "validate"
    agent: "result-validator"
    prompt: |
      You are a result validator. Review this response and determine if variable substitution worked correctly:
      
      Response: {{echo_result}}
      
      Expected values:
      - String should be: "hello-world"
      - Number should be: 42
      - Boolean should be: "true"
      
      Criteria:
      - Did the agent receive all three variables?
      - Were the values substituted correctly (not showing as {{variable_name}})?
      - Do the echoed values match the expected values?
      
      Provide your verdict in this exact format at the end:
      ✅ VERDICT: PASS
      or
      ❌ VERDICT: FAIL
      
      Explain your reasoning briefly before the verdict.
    timeout: 30
