name: "04-profile-resolution"
description: "Smoke test: Profile resolution → Config merging → Capability assembly"
version: "1.0.0"
author: "Amplifier Recipes Team"
created: "2025-12-10T00:00:00Z"
tags: ["smoke-test", "cli-integration", "profile-resolution", "phase-0"]

# Test Objective:
# Validates that the CLI correctly loads profiles, resolves inheritance, and assembles agent capabilities.
# This tests the integration: Profile loading → Config assembly → Tool/capability availability
#
# What We're Validating:
# - CLI loads profile definitions via amplifier-profiles
# - Profile inheritance (extends) is resolved correctly
# - Mount plan is assembled from profile configuration
# - Tools from profile are available to spawned agents
#
# Success Criteria:
# - Agent reports access to multiple tools from profile
# - Expected core tools (read_file, bash, grep, etc.) are present
# - Profile configuration successfully applied
#
# Scope: This is a CLI integration test (NOT testing recipe engine features)

steps:
  - id: "check-profile-config"
    agent: "foundation:explorer"
    prompt: |
      Report your configuration - what tools do you have access to?
      
      Please list 3-5 tools that are available to you.
      Keep the response concise.
    output: "config_info"
    timeout: 30

  - id: "validate"
    agent: "result-validator"
    prompt: |
      Evaluate whether profile resolution and configuration assembly succeeded.
      
      Agent Configuration Report:
      {{config_info}}
      
      Validation Criteria:
      1. Agent reports access to multiple tools (indicates profile was loaded)
      2. Core tools are present (e.g., read_file, bash, grep, glob, or similar)
      3. Configuration indicates profile was applied correctly
      
      Provide a conversational assessment with clear evidence, then end with:
      ✅ VERDICT: PASS - if all criteria met
      ❌ VERDICT: FAIL - if any criteria failed
    timeout: 30
